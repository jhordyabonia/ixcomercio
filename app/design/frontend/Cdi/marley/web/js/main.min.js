require(["jquery","jquery/ui","mage/translate","mainJs","domReady!"],function(w,e){"use strict";var j=jQuery("header").innerHeight(),Q=jQuery(window).width(),_=w(".block-minicart .product-item");w(document).ready(function(){if(_=_.length,Q<=959?w("html body").css("paddingTop",j):w("html body").css("paddingTop",0),w("#scroll-to-top").click(function(){w("html, body").animate({scrollTop:0},500,"swing")}),Q<=768){var e=w("#search-wrapper-mobile .block-search"),t=w("#mini-cart-wrapper-mobile .minicart-wrapper");0==w(e).length&&w("#search-wrapper-mobile").append(w(".block-search")),0==w(t).length&&w("#mini-cart-wrapper-mobile").append(w(".minicart-wrapper"))}else w(e).remove(),w(t).remove();if(w(".products-grid .product-items").length){var i=w(".products-grid .product-items > .item"),a=w(i).find(".product-image-wrapper"),n=w(i).find(".product-name"),r=w(i).find(".atributo-familia"),o=w(i).find(".price-box"),s=[],d=[],l=[],p=[],c=[];setTimeout(function(){jQuery.each(a,function(e,t){d.push(jQuery(t).innerHeight())}),Math.max.apply(Math,d),jQuery(a).css("minHeight",Math.max.apply(Math,d)+"px"),jQuery.each(n,function(e,t){l.push(jQuery(t).innerHeight())}),Math.max.apply(Math,l),jQuery(n).css("minHeight",Math.max.apply(Math,l)+"px"),jQuery.each(r,function(e,t){p.push(jQuery(t).innerHeight())}),Math.max.apply(Math,p),jQuery(r).css("minHeight",Math.max.apply(Math,p)+"px"),jQuery.each(o,function(e,t){c.push(jQuery(t).innerHeight())}),Math.max.apply(Math,c),jQuery(o).css("minHeight",Math.max.apply(Math,c)+"px"),jQuery.each(i,function(e,t){s.push(jQuery(t).innerHeight())}),Math.max.apply(Math,s),jQuery(i).css("height",Math.max.apply(Math,s)+"px")},500)}if(jQuery(".control-qty").on("click",function(e){var t=jQuery(this),i=t.parent(),a=i.find("input.input-text.qty"),n=parseInt(a.val());t.hasClass("remove")?2<=n&&(a.val(n-1),2==n&&t.addClass("disable")):t.hasClass("add")&&(a.val(n+1),i.find(".remove").removeClass("disable"))}),w("header.header-primary-container .mobnav-trigger-wrapper .mobnav-trigger").click(function(){jQuery("header.header-primary-container .wrapper-nav").css("top",j+"px"),w(this).hasClass("open")?(w(this).removeClass("open"),w("header.header-primary-container .wrapper-nav").slideUp()):(w(this).addClass("open"),w("header.header-primary-container .wrapper-nav").slideDown())}),w("footer .footer-primary .row>div h3").click(function(){w(this).hasClass("open")?(w(this).removeClass("open"),w(this).parent().find("ul").slideUp()):(w("footer .footer-primary .row > div h3").removeClass("open"),w("footer .footer-primary .row > div ul").slideUp(),w(this).addClass("open"),w(this).parent().find("ul").slideDown())}),jQuery(".hero-banner")){var u=jQuery(".hero-banner .text-overlay-banner");jQuery(".hero-banner .text-block-banner").prepend(u),jQuery(u).addClass("show")}var f=w("input.required-entry, select.required-entry");w.each(f,function(e,t){w(t).parents(".field").hasClass("required")||w(t).parents(".field").addClass("required")});var h=w(".skip-content"),m=w(".skip-link");m.on("click",function(e){e.preventDefault();var t=w(this),i=t.attr("href"),a=w(i),n=a.hasClass("skip-active")?1:0;m.removeClass("skip-active"),h.removeClass("skip-active"),n?t.removeClass("skip-active"):(t.addClass("skip-active"),a.addClass("skip-active"))});var g,v,y;f=w("input.required-entry, select.required-entry");function b(e,i,t){if(w(e).length&&i.length){var a=w(e).val(),n=w(i).find("option");n.length?"text"==t?w.each(n,function(e,t){w(t).text()==a&&(w(t).prop("selected",!0),setTimeout(function(){w(i).trigger("change")},500))}):"val"==t&&w.each(n,function(e,t){w(t).attr("value")==a&&(w(t).prop("selected",!0),setTimeout(function(){w(i).trigger("change")},500))}):console.log("el ws no retornÃ³ opciones para "+w(i).attr("id"))}}function x(o,e){w("body").trigger("processStart"),"GT"==w('[name="country_id"]').val()?w(o).find('input[name="postcode"]').parents(".field").hide():w(o).find('input[name="postcode"]').parents(".field").show(),w(o).find('input[name="postcode"]').val("");var s=w(o).find("> .field.street .control .additional .control"),d=w(o).find(e).parent();w(s).find("input").hide(),w(d).find("input").hide(),y=w(o).find('> .field input[name="city"]').parent(),w.ajax({url:"/places/search/",type:"GET",dataType:"json",success:function(t){if(w(v).find("input").length){w(v).find("input").hide();var i='<select id="fieldStateCheckout" class="select" name="state_id" aria-required="true" aria-invalid="false"><option data-title="" value="">'+w.mage.__("Please select a region, state or province.")+"</option>";w.each(t,function(e,t){i+="<option value='' parentid='"+t.Id+"''>"+t.Name+"</option>"}),i+="</select>",0==w(o).find("#fieldStateCheckout").length&&w(v).append(i),b(w(o).find("#fieldStateCheckout").parent().find("input"),w(o).find("#fieldStateCheckout"),"text")}else{var e=w(v).find("select option");w.each(e,function(e,i){var a=w(i).text();w.each(t,function(e,t){t.Name==a&&(w(i).attr("parentId",t.Id),w(i).show())})})}w(y).find("input").hide();var a='<select id="fieldCityCheckout" class="select" name="cities_id" aria-required="true" aria-invalid="false" disabled><option data-title="" value="">'+w.mage.__("Please select a city.")+"</option></select>";0==w(o).find("#fieldCityCheckout").length&&w(y).append(a);var n='<select id="fieldZoneCheckout" class="select" name="zone_id" aria-required="true" aria-invalid="false" disabled><option data-title="" value="">'+w.mage.__("Please select a zone.")+"</option></select>";0==w(o).find("#fieldZoneCheckout").length&&w(d).append(n),w("body").trigger("processStop");var r=w(v).find("select#fieldStateCheckout");w(r).on("change",function(e){w("body").trigger("processStart"),w(o).find('input[name="postcode"]').val(""),w.ajax({url:"/places/search/",data:"parentId="+w(r).find("option:selected").attr("parentId"),type:"GET",dataType:"json",success:function(e){w(y).find("select").attr("disabled",!1),w(y).find('select option:not([value=""])').remove(),w.each(e,function(e,t){w(y).find("select").append("<option value='"+t.Id+"' parentId='"+t.Id+"'>"+t.Name+"</option>")}),b("#city","#fieldCityCheckout","text"),w("body").trigger("processStop")}}),w(v).find("input").val(w(this).find("option:selected").text()),w(v).find("input").keyup()}),w(o).find("#fieldCityCheckout").on("change",function(e){w("body").trigger("processStart"),w(o).find('input[name="postcode"]').val("");w(y).find("select option:selected");w(y).find("input").val(w(this).find("option:selected").text()),w(y).find("input").keyup(),w.ajax({url:"/places/search/",data:"parentId="+w(this).find("option:selected").attr("parentId"),type:"GET",dataType:"json",success:function(e){w(d).find("select").attr("disabled",!1),w(d).find("select option").remove(),w(d).find("select").append('<option data-title="" value="" selected>Please select a zone.</option>'),w.each(e,function(e,t){w(d).find("select").append("<option value='"+t.PostalCode+"' parentId='"+t.ParentId+"' postalCode='"+t.PostalCode+"'>"+t.Name+"</option>")}),b("#zone_id","#fieldZoneCheckout","val"),w("body").trigger("processStop")}})}),w(d).find("select").on("change",function(e){w("body").trigger("processStart");var t=w(d).find("select option:selected");w(d).find("input").val(w(this).find("option:selected").text()),w(d).find("input").keyup(),w(s).find("input").val(w(this).find("option:selected").text()),w(s).find("input").keyup(),"null"!=w(t).attr("postalCode")?(w(o).find('input[name="postcode"]').show(),w(o).find('input[name="postcode"]').val(w(t).attr("postalCode"))):(w(o).find('input[name="postcode"]').hide(),w(o).find('input[name="postcode"]').val(w(t).text())),w(o).find('input[name="postcode"]').keyup(),w("body").trigger("processStop")})}})}w.each(f,function(e,t){w(t).parents(".field").hasClass("required")||w(t).parents(".field").addClass("required")}),w("body").hasClass("checkout-index-index")&&(g=setInterval(function(){v=w('form .fieldset.address input[name="region"]').parent(),1<=w(v).length&&(x("form .fieldset.address",'> .field input[name="custom_attributes[zone_id]"]'),clearInterval(g))},1e3)),w("body").hasClass("checkout-cart-index")&&(g=setInterval(function(){v=w('form .fieldset.estimate input[name="region"]').parent(),1<=w(v).length&&(x("form .fieldset.estimate",'> .field input[name="custom_attributes[zone_id]"]'),clearInterval(g))},1e3)),-1<window.location.href.indexOf("customer")&&(g=setInterval(function(){v=w('form.form-address-edit .fieldset input[name="region"]').parent(),1<=w(v).length&&(w(".form-address-edit .field-name-firstname").before(w(".field-identification")),w(".form-address-edit .field-zone_id").after(w(".field.zip")),x("form.form-address-edit .fieldset",'.field input[name="zone_id"]'),clearInterval(g))},1e3));var C=0;w(document).on("change","[name='billing-address-same-as-shipping']",function(){if(0==w(".field-select-billing select").length){if(C+=1,0==w(this).prop("checked")){var e=w(".payment-method._active .billing-address-form form fieldset.address");v=w(e).find('input[name="region"]').parent(),console.log("fieldStateCheckout "+v),1<=w(v).length&&1==C&&x(e,'> .field input[name="custom_attributes[zone_id]"]')}}else C=0}),w(document).on("change","[name='billing_address_id']",function(){C+=1,v=w('.billing-address-form form fieldset.address input[name="region"]').parent(),C<=1&&x(w(".billing-address-form form fieldset.address"),'> .field input[name="custom_attributes[zone_id]"]')}),w(document).on("change","[name='country_id']",function(){"GT"==w(this).val()?w('input[name="postcode"]').parents(".field").hide():w('input[name="postcode"]').parents(".field").show()});var k=w("footer a");w.each(k,function(e,t){if("Zendesk Support"==t.innerText||"Preguntas frecuentes"==t.innerText){var i=w(this).parent();w("footer .col-md-3:eq(0) .nav-submenu").append(i)}})});var t,i=0;return w(document).ajaxComplete(function(){""!=w(".totals.sub .price").text()&&1==(i+=1)&&function(){var e=w(".cart.table-wrapper .items>.item .col.subtotal .price"),a=0;w.each(e,function(e,t){var i=w(t).text().split(/\s+/);w.each(i,function(e,t){var i=t.replace(/\./g,"");i=i.replace(/\,/g,"."),1==w.isNumeric(parseFloat(i))&&(a+=parseFloat(i))})}),console.log(a),console.log(Number(a).toFixed(2));var t=w(".totals.sub .price").text().split(/\s+/),n=0;w.each(t,function(e,t){var i=t.replace(/\./g,"");i=i.replace(/\,/g,"."),1==w.isNumeric(i)&&(n+=parseFloat(i))}),console.log(n),console.log(Number(n).toFixed(2));var i=w(".totals-tax-summary .price").text().split(/\s+/),r=0;w.each(i,function(e,t){var i=t.replace(/\./g,"");i=i.replace(/\,/g,"."),1==w.isNumeric(i)&&(r+=parseFloat(i))}),console.log(r),console.log(Number(r).toFixed(2)),console.log(Number(n+r).toFixed(2)),Number(a).toFixed(2)!=Number(n+r).toFixed(2)?(console.log("dif"),w(".cart-container form.form-cart .cart.main.actions .action.update").trigger("click")):console.log("similar")}()}),jQuery(window).on("scroll",function(){clearTimeout(t),t=setTimeout(function(){100<w(this).scrollTop()?w("#scroll-to-top").fadeIn():w("#scroll-to-top").fadeOut()},500)}),jQuery(window).on("resize",function(){if(j=jQuery("header").innerHeight(),Q<=959?w("html body").css("paddingTop",j):w("html body").css("paddingTop",0),Q<=768){var e=w("#search-wrapper-mobile .block-search"),t=w("#mini-cart-wrapper-mobile .minicart-wrapper");0==w(e).length&&w("#search-wrapper-mobile").append(w(".block-search")),0==w(t).length&&w("#mini-cart-wrapper-mobile").append(w(".minicart-wrapper"))}else w(e).remove(),w(t).remove()}),e});